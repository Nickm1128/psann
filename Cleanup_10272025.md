PSANN API Cleanup TODO - 2025-10-27  
Progress: 84 / 189 bullets complete (44.4% simple; 76.3% complexity-weighted) — update this tally whenever checklist statuses change.

**Execution Flow (CPU First, GPU Last)**
- Drive all CPU-bound cleanup and documentation work before touching accelerator-dependent items; see **CPU Prep Before GPU Run** for the current pickup list.
- Keep every CUDA-required test and benchmark parked under **Final GPU Sweep (run last)** so local progress never stalls on missing hardware.
- Only schedule the GPU sweep once a remote slot is secured; until then, keep iterating on CPU coverage, docs, and configs.

**Session 2025-11-02 — Applied Decisions (completed)**
- Decisions processed:
  - Logging dirs: recommend local `runs/hisso/` and Colab/Runpod `/content/hisso_logs/`; keep explicit `--output-dir` in CLI help.
  - Extras datasets: archive in compendium; active sections now primary-only.
  - Mixed precision guidance: finalize wording (AMP float16 + GradScaler) in logging spec.
- Applied changes:
  - CLI/Docs: updated `src/psann/scripts/hisso_log_run.py` help; added “Recommended Logging Directories” and AMP guidance in `docs/HISSO_logging_spec.md`; added README note (Colab vs local logging dirs).
  - Compendium: added GPU Sweep Summary table (includes Runpod 212855/153117) and archived extras note.
  - Notebook: inserted 212855/153117 metrics block and set `OUTPUT_ROOT` to `/content/hisso_logs` in `notebooks/HISSO_Logging_GPU_Run.ipynb`.
  - Board hygiene: moved Blocked items to a resolved one-liners section; added Session Log entry; linked compendium GPU summary from Autosummary.
- Validation results (local):
  - `PYTHONPATH=src python -m pytest -q -m "not slow"` → 128 passed, 1 skipped, 18 deselected.
  - CUDA subset (no device present): `-k cuda` and early-stopping CUDA test both skipped.
- Commit: `docs+board: finalize AMP guidance; archive extras; add GPU sweep summary; logging-dir guidance`

**Progress Snapshot (2025-11-02)**
- Board totals: 84 / 189 complete (44.4% simple); complexity-weighted progress 76.7% (computed from (c=K) values on the Operations Board).
- Runpod GPU WaveResNet logging completed via `configs/hisso/wave_resnet_small.yaml` on NVIDIA L4 (CUDA 12.1 build). Artifacts: `runs/hisso/wave_resnet_cuda_runpod_20251102_212855/` (duration ~18.37 s, ~113.07 eps/s; best_epoch 56; train/val/test 0.722/0.864/0.835; reward_mean −0.114 ± 0.0103; turnover 3.18; Sharpe −1.87; AMP float16) and `runs/hisso/wave_resnet_cuda_runpod_20251102_153117/` (duration 19.41 s, ~107.3 eps/s; best_epoch 17; train/val/test 0.621/0.755/0.670; reward_mean −0.114 ± 0.010; turnover 2.69). Docs refresh applied to compendium/README/WaveResNet notebook (2025-11-02).
- CUDA validation completed on Runpod L4 (torch 2.8.0+cu128 reports CUDA: True). Test results:
  - Quick subset: `pytest -m "not slow"` â†’ 129 passed, 18 deselected, 1 warning in 21.23s.
  - Full suite: `pytest` â†’ 147 passed, 1 warning in 21.70s.
  - HISSO core: `tests/test_hisso_primary.py` â†’ 14 passed in 5.6s; `tests/test_hisso_smoke.py tests/test_hisso_logging_cli.py` â†’ 5 passed in 4.70s.
  - CUDA-specific: `tests/test_training_loop.py::test_training_loop_early_stopping_runs_on_cuda` â†’ 1 passed in 3.39s.
  - Spines: `tests/test_wave_resnet.py tests/test_wave_resnet_regressor.py` â†’ 16 passed in 3.76s; `tests/test_conv_nets.py tests/test_conv_stem_helper.py` â†’ 18 passed in 4.45s.
- Prior snapshot follows for continuity.
**Progress Snapshot (2025-10-29)**
- 71 checklist bullets now carry completion stamps out of 189 tracked items (~37.6%); the HISSO logging CLI, config templates, docs refresh, new `with_conv_stem` helper, dataloader shuffle guidance, README estimator examples, and HISSO dataset alignment (validated via `configs/hisso/dense_cpu_smoke.yaml`) land ahead of the final GPU validation pass.
- Regression suites expanded: aliasing, error messaging, shape/layout, dtype/device, estimator smoke, inference roundtrip, streaming coverage, metrics/reward stability, training-loop semantics, and serialization persistence all land in `tests/` with nightly-ready runtimes.
- Documentation updated wherever behavior changed (`README.md`, `docs/API.md`, `docs/examples/README.md`, `docs/diagnostics.md`, `docs/wave_resnet.md`, notebooks aligned with context builder/dtype guidance).
- Remaining high-leverage work clusters around HISSO CUDA validation (blocked by dataset tweaks for the logging CLI), scaler warm-start edge cases, and serialization smoke tests ahead of the final GPU sweep (see Outstanding investigations).

**Scope & Guardrails**
- Prioritize API surface exposed via `src/psann/__init__.py:1` and estimator classes in `src/psann/sklearn.py:1`.
- Unify shape semantics, parameter aliases, error messaging, and device/dtype handling across modules.
- Optimize hot paths in training/inference; avoid regressions in public behavior.
- Keep changes minimal and consistent with the current style; update docs where behavior changes.

**Global Consistency**
- Parameter aliasing policy (done 2025-10-28; alias resolution unified via `resolve_int_alias` and estimator `set_params` normalization with regression tests)
  - Adopt `resolve_int_alias` consistently for: `hidden_units`/`hidden_width`, `conv_channels`/`hidden_channels` across nn/conv/preproc/estimators.
  - Single mismatch policy per module family: estimators=warn, core models=error. Verify messages and categories.
  - Implement `set_params` alias normalization in estimators using `_normalize_param_aliases` (currently defined but unused) to keep sklearn parity.
  - Subtasks
    - Audit: grep for alias pairs and confirm all flows go through resolver.
    - Implement/override `set_params` in estimators to call `_normalize_param_aliases`. (done 2025-10-27 via `PSANNRegressor.set_params`)
    - Add unit tests for alias behaviors and warnings. (done 2025-10-27 in `tests/test_regressor_aliases.py`)
    - Update docs to reference canonical names. (done 2025-10-27 in `docs/API.md` and `README.md`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- Error/exception messaging (done 2025-10-27; validators now emit consistent `ValueError`/`TypeError` messages with shapes echoed and warnings using stacklevel>=2)
  - Standardize `ValueError` vs `TypeError` usage and message formats; ensure shapes are echoed in errors. (done 2025-10-27)
  - Unify deprecation warnings and user warnings with `stacklevel=2` or higher where user code is the caller.
  - Subtasks
    - Pass audit: skim validators across `sklearn.py`, `estimators/_fit_utils.py`, `episodes.py`, `hisso.py`. (done 2025-10-27 via targeted updates to `_fit_utils.py`, `episodes.py`, `hisso.py`)
    - Normalize message phrasing and include expected/received shapes/values. (done 2025-10-27 in `_fit_utils.py`)
    - Add tests for representative failure paths (context length, shape mismatch, invalid params). (done 2025-10-27 in `tests/test_error_messages.py`)
    - Update TODO progress; add summary to Notes. (done 2025-10-27)

- API exports and naming (done 2025-10-27; verified `__all__` against live symbols and refreshed docs to use canonical exports)
  - Verify `src/psann/__init__.py:1` `__all__` entries exist and are intended for public API. (done 2025-10-27 via local import audit)
  - Confirm trailing-underscore naming like `siren_uniform_` stays consistent across imports and docs. (done 2025-10-27; no mismatched references remaining)
  - Subtasks
    - Cross-check exports against concrete symbols; remove unintended/legacy exports. (done 2025-10-27; no removals required after audit)
    - Ensure docstrings and README references match public names. (done 2025-10-27 in `README.md`, `docs/API.md`, `docs/examples/README.md`, `docs/diagnostics.md`, `docs/wave_resnet.md`)
    - Update TODO progress; add summary to Notes. (done 2025-10-27)

- Shape/layout semantics (done 2025-10-28; preserve-shape prep mirrors validation tensors and errors now call out CF/CL mismatches)
  - Keep `preserve_shape` vs flattened flows consistent; confirm `channels_first`/`channels_last` handling is uniform.
  - Ensure per-element targets align in both training and validation paths.
  - Subtasks
    - Review `_prepare_preserve_shape_inputs` and validation tensor prep for symmetry and helpful errors. (done 2025-10-28 via `_prepare_preserve_shape_inputs` / `_prepare_validation_tensors`)
    - Add tests: CF/CL, per-element True/False, output_shape provided/missing. (done 2025-10-28 in `tests/test_preserve_shape_layout.py`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- Device/dtype policy (done 2025-10-28; float32 interop enforced, device caching added, and dtype transfers audited across fit/predict/HISSO)
  - Enforce float32 for numpy interop; ensure device transfers are minimal and wrapped with `no_grad` where possible.
  - Subtasks
    - Audit CPU/GPU copies in `predict`, `predict_sequence`, HISSO trainer, and preproc. (done 2025-10-28 via `PSANNRegressor._run_model`/`run_supervised_training`/`hisso.py`)
    - Add fast paths for already-correct dtype/device tensors. (done 2025-10-28 by caching `_model_device_`, CPU sharing in `_prepare_validation_tensors`, and scoped tensor helpers)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**Estimators (sklearn.py)**
- Remove duplicate class definition (done 2025-10-27; authoritative `ResConvPSANNRegressor` retained at `sklearn.py:2209`)
- `ResConvPSANNRegressor` duplicate resolved; single authoritative definition lives at `src/psann/sklearn.py:2209`.
  - Subtasks
    - Delete duplicate class block; ensure imports/`__all__` remain valid. (verified 2025-10-27; legacy block no longer present)
    - Add a smoke test constructing all estimators exported in `__init__`. (done 2025-10-27 in `tests/test_estimators_smoke.py`)
    - Update TODO progress; add summary to Notes. (done 2025-10-27)

- set_params/get_params normalization (done 2025-10-28; estimator `set_params` normalizes aliases and warns consistently)
  - Wire `_normalize_param_aliases` into `set_params` when sklearn is present; ensure fallback stub mirrors behavior.
  - Subtasks
    - Override `set_params` in `PSANNRegressor` to normalize and call super.
    - Add tests for updating aliases post-init (e.g., `hidden_width`, `conv_channels`).
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- Fit pipeline invariants (done 2025-10-28; context builder caching, scaler resets, and validation prep verified via tests)
  - Validate consistency between `normalise_fit_args`, `prepare_inputs_and_scaler`, and `_make_fit_hooks` selection.
  - Ensure `context_builder` resolution is cached and dimension is propagated to `context_dim` consistently.
  - Subtasks
    - Tests for: context_builder "cosine", user-provided context arrays, validation triples. (done 2025-10-28 in `tests/test_context_builder.py`)
    - Confirm scaler incremental update logic with warm_start=True. (done 2025-10-28 via `_scaler_fit_update` reset + `tests/test_regressor_basic.py`.)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- Inference and sequence APIs (done 2025-10-28; save/load parity and sequence rollouts locked via regression suite)
  - `_prepare_inference_inputs` and `_reshape_predictions` must preserve fitted shapes, handle singleton outputs cleanly, and honor `channels_last` when requested.
  - Subtasks
    - Add roundtrip tests for save/load; verify predict/score parity after reload. (done 2025-10-28 in `tests/test_regressor_inference.py::test_save_load_roundtrip_preserves_predictions`)
    - Tests for `predict_sequence` and `predict_sequence_online` shape/output consistency. (done 2025-10-28 in `tests/test_regressor_inference.py::test_predict_sequence_shapes_and_online_updates`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- Streaming updates (done 2025-10-28; streaming optimizer rebuild logic covered by `tests/test_stateful_streaming.py`)
  - Confirm `_ensure_streaming_ready` properly tracks model token and lr changes; verify `_coerce_stream_target` reshaping rules.
  - Subtasks
    - Add unit tests for scalar, vector, and reshaped targets in streaming.
    - Validate state update toggling (`set_state_updates`) around streaming steps.
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**HISSO (hisso.py, estimators/_fit_utils.py)**
- Options normalization and transforms (done 2025-10-28; option builders emit consistent warning paths and transform parity is covered)
  - Confirm `HISSOOptions.from_kwargs` behavior and allowed transforms; align numpy-space transform with torch-space version.
  - Subtasks
    - Tests for `identity/softmax/tanh` with edge cases (large values, stability).
    - Ensure warning on non-scalar input noise is helpful and non-fatal.
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- Warm-start + episodic training (done 2025-10-28; HISSO warm-start honors `lsm_lr`, trainer history preserved, state pointers validated)
  - Ensure supervised warm-start honors `lsm_lr` param group and batch shuffling rules for stateful models.
  - Subtasks
    - Tests for warm-start data shape, primary_dim match, and optimizer lr overrides.
    - Verify HISSO run updates `history_`, trainer config persistence, and reward/context extractor pointers.
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- Trainer internals and performance (done 2025-10-29; determinism, gradient clip hooks, and dataset transfer profiling captured; GPU profiling deferred to CUDA validation track)
  - Validate episode sampling coverage, gradient clipping, and reward stability; ensure `no_grad` is used where safe. (done 2025-10-29 via deterministic regression coverage and updated HISSOTrainer profiling)
  - Subtasks
    - Microbench profile of trainer loop; confirm device transfers are batched. (done 2025-10-29 via `HISSOTrainer.profile` transfer metrics and `tests/test_hisso_primary.py::test_hisso_profile_reports_batched_device_transfer`)
    - Add seed control tests for determinism. (done 2025-10-29 in `tests/test_hisso_primary.py::test_hisso_seed_controls_episode_sampling`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**Models & Layers**
- WaveResNet backbone (`src/psann/models/wave_resnet.py:1`) (done 2025-10-28; w0 warmup, progressive depth, context gating, and dropout behaviors now regression-tested)
  - Verify w0 warmup and progressive depth logic; inspect optimizer param-group augmentation when adding blocks. (done 2025-10-28 via `tests/test_wave_resnet_regressor.py::test_wave_resnet_w0_warmup_schedule_progresses_to_target` and `::test_wave_resnet_progressive_depth_adds_blocks_and_optimizer_group`)
  - Subtasks
    - Unit tests: w0 schedule monotonicity; depth growth schedule and new params added to optimizer. (done 2025-10-28 in `tests/test_wave_resnet_regressor.py`)
    - Confirm context_dim gating of FiLM/phase shift paths; dropout behavior. (done 2025-10-28 in `tests/test_wave_resnet.py`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- Residual and dense cores (`src/psann/nn.py:1`) (done 2025-10-28; DropPath train/eval toggles and stateful block commit/reset flows covered by dedicated tests)
  - Unify norm options: estimators use strings 'rms', 'layer', 'none' consistently with residual blocks.
  - Subtasks
    - Add tests for residual alpha init and DropPath behavior (train vs eval). (done 2025-10-28 in `tests/test_psann_nn.py::test_residual_block_droppath_toggles_with_training_mode`)
    - Validate stateful PSANNBlock path: commit/reset semantics across epochs/batches. (done 2025-10-28 in `tests/test_psann_nn.py::test_psann_net_state_commit_reset_and_disable_updates`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- Convolutional nets (`src/psann/conv.py:1`) (done 2025-10-28; 1d/2d/3d segmentation vs pooled outputs and alias errors now enforced)
  - Confirm SIREN-like init for convs; check segmentation head shapes for 1d/2d/3d. (done 2025-10-28 via `tests/test_conv_nets.py::test_psann_conv1d_segmentation_and_pooled_shapes` / `::test_psann_conv2d_and_3d_segmentation_shapes`)
  - Subtasks
    - Add tests for forward shapes (segmentation_head True/False) and pooling behavior. (done 2025-10-28 in `tests/test_conv_nets.py`)
    - Validate alias policy (`conv_channels`/`hidden_channels`) error vs warn consistent with spec. (done 2025-10-28 in `tests/test_conv_nets.py::test_conv_alias_mismatch_raises`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**Preprocessing**
- LSM/Expander builders (`src/psann/preproc.py:1`) (done 2025-10-28; builder path matrix covered and estimator freeze/dimension propagation verified via regression tests)
  - Ensure spec resolution covers dict/spec/module uniformly; confirm training gates and shape conversions.
  - Subtasks
    - Add tests for each builder path; check freeze when `lsm_train=False`. (done 2025-10-28 in `tests/test_preproc.py` and `tests/test_regressor_lsm.py::test_regressor_with_lsm_spec_uses_expanded_dim_and_freezes_preproc`)
    - Validate `out_channels`/`output_dim` propagation into estimators. (done 2025-10-28 via `tests/test_regressor_lsm.py::test_regressor_with_lsm_spec_uses_expanded_dim_and_freezes_preproc` / `::test_regressor_with_conv_lsm_spec_sets_channels_and_freezes`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**State & Tokenization**
- StateController (`src/psann/state.py:1`) (done 2025-10-28; commit/reset flows, detach toggle, and negative-axis warnings now regression-tested)
  - Verify detach semantics and saturation/collapse warnings; feature_dim broadcasting across N-D inputs.
  - Subtasks
    - Tests for apply/commit/reset paths and warnings thresholds. (done 2025-10-28 in `tests/test_state_controller.py::test_state_controller_commit_and_reset_roundtrip` / `::test_state_controller_supports_negative_feature_dim_and_warning_reset`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

- SimpleWordTokenizer and SineTokenEmbedder (done 2025-10-28; encode/decode flows, BOS/EOS gating, and sine frequency schedule now under regression tests)
  - Validate unknown token handling and BOS/EOS gating; SineTokenEmbedder lazy table and trainable path.
  - Subtasks
    - Add encode/decode and embedding tests; frequency schedule correctness. (done 2025-10-28 in `tests/test_tokenizer_embedder.py`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**Metrics & Rewards**
- Portfolio metrics (`src/psann/metrics.py:1`) and reward registry (`src/psann/rewards.py:1`) (done 2025-10-28; numeric stability clamps landed in `sharpe_ratio` with registry overwrite coverage in `tests/test_metrics_rewards.py`)
  - Ensure numeric stability (eps clamps), shapes (vector vs matrix), and consistent linkage via registry. (done 2025-10-28 via short-series guard in `sharpe_ratio` and minimal-history checks in `portfolio_metrics`)
  - Subtasks
    - Tests: equity_curve edge cases (T<2), sharpe denom epsilon, registry lookups and overwrite behavior. (done 2025-10-28 in `tests/test_metrics_rewards.py`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**Serialization**
- Estimator checkpoints (`src/psann/sklearn.py:1549`) (done 2025-10-28; `_build_serialized_payload` now persists context builders and HISSO metadata with regression coverage in `tests/test_regressor_inference.py`)
  - Ensure context builder dims, HISSO trainer config, and reward/context extractors survive save/load for inference utilities. (done 2025-10-28 via WaveResNet roundtrips in `tests/test_regressor_inference.py::test_save_load_roundtrip_preserves_context_builder` / `::test_save_load_roundtrip_preserves_hisso_metadata`)
  - Subtasks
    - Add serialization tests hitting context builder + HISSO pipelines. (done 2025-10-28 in `tests/test_regressor_inference.py`)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**Training Loop & Performance**
- Core loop (`src/psann/training.py:1`) (done 2025-10-28; LR schedule interpolation, early-stopping restores, and hook invocation now regression-tested in `tests/test_training_loop.py`; dataloader shuffle guidance tracked under Outstanding investigation #8)
  - Validate LR schedule interpolation, early stopping best-state capture/restore, and state resets. (done 2025-10-28 via `_ScheduledLoss` fixture in `tests/test_training_loop.py`)
  - Subtasks
    - Add tests for early stopping restoring best weights; gradient_hook and epoch_callback are called. (done 2025-10-28 in `tests/test_training_loop.py::test_training_loop_early_stopping_restores_best_state_and_calls_hooks`)
    - Profile dataloader shuffle vs stateful constraints; document guidance. (done 2025-10-29 via README/TECHNICAL_DETAILS updates and 	ests/test_dataloader_shuffle.py)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**Documentation & Examples**
- Update README and TECHNICAL_DETAILS where behavior or names change; ensure notebooks reflect the stable API. (done 2025-10-29; Quick Start now includes deterministic estimator examples, docs call out alias deprecations, notebooks aligned with the API)
  - Subtasks
    - Patch docs for alias deprecations and estimator duplication removal. (done 2025-10-28 across `README.md`, `docs/API.md`, `docs/examples/README.md`, `docs/diagnostics.md`)
    - Add minimal, deterministic examples for `WaveResNetRegressor`, `ResPSANNRegressor`, `ResConvPSANNRegressor`. (done 2025-10-29 in `README.md` Quick Start section)
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**Test Plan & CI**
- Expand unit tests to cover aliasing, shapes, context, HISSO flows, and streaming.
  - Subtasks
    - Add focused tests only where coverage is missing; avoid unrelated refactors.
    - Gate slow HISSO tests behind `-m slow`; keep default suite fast.
    - Update TODO progress; add summary to Notes. (done 2025-10-28)

**Notes**
- Progress summary (2025-10-29): Global Consistency, estimator fit/inference flows, and HISSO option normalization are complete with enforcing tests; trainer profiling now emits dataset transfer metrics with deterministic sampling coverage, leaving CUDA profiling, logging CLI, and documentation refresh as the remaining high-impact threads.
- Completed deliverables:
  - Alias normalization unified across estimators and builders with `tests/test_regressor_aliases.py` and doc updates in `README.md`/`docs/API.md`.
  - Error messaging harmonized in `_fit_utils.py`, `episodes.py`, `hisso.py`; regression coverage in `tests/test_error_messages.py` now asserts shape echoes and warning categories.
  - Shape/layout consistency locked via `_prepare_preserve_shape_inputs` refactor and `tests/test_preserve_shape_layout.py`; validation errors now distinguish channel vs spatial mismatches.
  - HISSO trainer profiling captures batched dataset transfers and episode view reuse (`src/psann/hisso.py`), with regression coverage in `tests/test_hisso_primary.py::test_hisso_profile_reports_batched_device_transfer` and deterministic episode sampling validated by `::test_hisso_seed_controls_episode_sampling`.
  - HISSO logging CLI (`src/psann/scripts/hisso_log_run.py`) ships with config templates (`configs/hisso/`) and a CPU smoke test (`tests/test_hisso_logging_cli.py`) that verifies metric emission, event logs, and checkpoint exports; README now documents the workflow.
  - HISSO logging dataset loaders now emit primary-aligned price matrices, unblocking the dense baseline CLI run (`src/psann/scripts/hisso_log_run.py`), with coverage via `tests/test_hisso_logging_cli.py`; latest metrics recorded under `runs/hisso/dense_smoke_cpu_dev`.
  - WaveResNet HISSO dataset staged at `datasets/wave_resnet_small.npz` (320/96/96 splits, channels-first) for the pending runpod sweep; aligns with `configs/hisso/wave_resnet_small.yaml`. (done 2025-10-29)
  - WaveResNet CPU smoke run recorded via `configs/hisso/wave_resnet_cpu_smoke.yaml`, producing reference metrics at `runs/hisso/wave_resnet_cpu_smoke` (duration 20.5s, reward_mean~-0.127, throughput~335 eps/s, Sharpe NaN from negative equity curve). (done 2025-10-29)
  - Convolutional stems now configurable via `PSANNRegressor.with_conv_stem` / `ResPSANNRegressor.with_conv_stem`, reusing the shared estimator pipeline; regression coverage lands in `tests/test_conv_stem_helper.py`, and docs outline migration guidance.
  - Stateful dataloader guidance captured in `README.md` / `TECHNICAL_DETAILS.md`; regression coverage via `tests/test_dataloader_shuffle.py` ensures shuffle toggles off for epoch-level resets.
  - Device/dtype policy enforced through `_ensure_model_device`, shared float32 conversions, and `tests/test_device_dtype_policy.py`.
  - Estimator save/load + sequence behavior verified by `tests/test_regressor_inference.py`, completing the inference TODOs.
  - README Quick Start supplements the dense example with deterministic recipes for `ResPSANNRegressor`, `ResConvPSANNRegressor`, and `WaveResNetRegressor`, reinforcing the float32/device guidance.
  - Streaming readiness, HISSO warm-start flows, and option transforms validated with existing smoke/primary suites; doc guidance updated to stress CUDA pinning.
  - Training-loop coverage gap closed with minmax scaler warm-start regression (`tests/test_regressor_basic.py::test_minmax_scaler_warm_start_tracks_global_range`) and CUDA early-stopping smoke test (`tests/test_training_loop.py::test_training_loop_early_stopping_runs_on_cuda`).
  - WaveResNet and convolutional cores now exercise production-style configurations through `tests/test_wave_resnet.py::test_wave_resnet_forward_production_configs` and `tests/test_conv_nets.py::test_conv_forward_production_configs`, ensuring context toggles and preserve-shape segmentation variants stay guarded.
- Session handoff (2025-10-29 prep):
  - **Note:** GPU validation is intentionally deferred to the runpod session at the end of the checklist; focus on CPU-bound and documentation tasks first (see **Deferred GPU Work (final run)**).
  - Notebook alignment complete for repo-hosted demos; linked Colab variants (`PSANN_Minimal_ComputeParity_Colab.ipynb`, `PSANN_Light_Probes_Colab.ipynb`) were not found locally, so revisit their upstream copies before the next release tag.
  - HISSO logging CLI implemented (`src/psann/scripts/hisso_log_run.py`) with CPU smoke coverage; `datasets/wave_resnet_small.npz` is staged locally for the GPU runpod sweep (`configs/hisso/wave_resnet_small.yaml`). (done 2025-10-29)
  - Training-loop coverage (done 2025-10-28; minmax scaler warm-start regression added via `tests/test_regressor_basic.py::test_minmax_scaler_warm_start_tracks_global_range`, GPU early-stopping coverage landed in `tests/test_training_loop.py::test_training_loop_early_stopping_runs_on_cuda`).
  - WaveResNet/Conv forward coverage (done 2025-10-28; parameterized production configs in `tests/test_wave_resnet.py::test_wave_resnet_forward_production_configs` and `tests/test_conv_nets.py::test_conv_forward_production_configs` now cover context toggles plus segmentation/preserve-shape variants).
  - WaveResNet CPU smoke artifacts captured under `runs/hisso/wave_resnet_cpu_smoke`; use them as the baseline when comparing upcoming CUDA metrics. Copy the staged NPZ to the runpod node before launching.
  - Docs to revisit post-logging CLI: `docs/PSANN_Results_Compendium.md` (add logging CLI workflow), README GPU section (reference CLI + CUDA validation results), and any Colab notebooks once the CLI is live.
- Open questions for next session:
  - Confirm whether legacy extras datasets should be archived or linked from the new results compendium.
  - Decide on default logging directory for the HISSO CLI when running in Colab vs. local shells.
  - Align mixed-precision guidance once CUDA runs reveal AMP stability.

  - WaveResNet warmup and progressive-depth behaviors covered by `tests/test_wave_resnet_regressor.py`, ensuring w0 schedule monotonicity and optimizer param-group expansion; context gating and dropout invariants locked via `tests/test_wave_resnet.py`.
  - Residual/dense cores now exercised through `tests/test_psann_nn.py`, verifying DropPath off in eval vs stochastic in train and confirming stateful PSANN blocks stage/commit/reset as expected.
  - Convolutional nets checked via `tests/test_conv_nets.py`, confirming segmentation-head outputs preserve spatial shapes, pooled variants reduce to `(batch, out_dim)`, and alias mismatches raise per spec.
  - Preprocessor builders now regression-tested across module/spec/dict inputs in `tests/test_preproc.py`, with estimator freeze and dimension propagation validated via `tests/test_regressor_lsm.py`.
  - StateController detach toggles, commit/reset behaviour, and negative-axis warnings exercised in `tests/test_state_controller.py`, ensuring saturation/collapse messages fire once per reset.
  - SimpleWordTokenizer encode/decode coverage and SineTokenEmbedder frequency schedule/training mode verified in `tests/test_tokenizer_embedder.py`.
  - Portfolio metrics stability and reward registry overwrite guarantees covered by `tests/test_metrics_rewards.py`; short-series Sharpe guard prevents NaNs in downstream dashboards.
  - Training loop LR schedule, early-stopping restore, and hook invocation validated via `tests/test_training_loop.py`, capturing gradient and commit hooks plus patience exhaustion semantics.
  - Estimator serialization now retains context builders and HISSO metadata via `_build_serialized_payload`; regression coverage added in `tests/test_regressor_inference.py` to confirm save/load parity for WaveResNet checkpoints.
  - HISSO logging script requirements captured in `docs/HISSO_logging_spec.md`, providing a blueprint for Outstanding investigation #4 implementation.
- Session handoff (2025-10-29): Core backbone, State/Tokenizer, Metrics/Rewards, training-loop, serialization suites, and dataloader guidance are wrapped. Next session focuses on the GPU validation sweep and notebook refresh; HISSO CUDA runs remain queued for the final runpod sweep (see **Deferred GPU Work (final run)**).
- Regression coverage status:
  - Nightly set exercises aliasing, context builders, device/dtype, streaming, error messaging, HISSO warm-start, metrics/reward stability, and estimator smoke paths (see `tests/` additions dated 2025-10-27/28).
  - Nightly set exercises aliasing, context builders, device/dtype, streaming, error messaging, HISSO warm-start, metrics/reward stability, estimator smoke paths, convolutional stems, and dataloader shuffle checks.
- Remaining gaps: model-specific forward tests (WaveResNet/conv/dense cores) under CUDA, mixed-precision training loops, and the GPU metrics handoff for docs/notebooks once runpod runs complete (`dense_cpu_smoke` now succeeds via `runs/hisso/dense_smoke_cpu_dev`; GPU run waits on dataset staging).
- README + docs refreshed with canonical names, alias guidance, device expectations, context builder usage, convolutional stems, and dataloader shuffle policy (2025-10-27/29).
- TECHNICAL_DETAILS.md refreshed with context builder + float32 guidance, convolutional stem helper notes, and dataloader shuffle policy (2025-10-28/29); notebooks updated with top-level imports + dtype reminders (WaveResNet demo, SineParam comparison, parity Colab notebook).
- docs/PSANN_Results_Compendium.md documents the pending runpod HISSO sweep and outlines artifact collection steps (2025-10-29).
  - docs/lsm_robustness_todo.md trimmed to remove legacy extras backlog and highlight active state tasks (2025-10-28).
- Outstanding investigations after review:
  1. (done 2025-10-28) Align notebooks (`notebooks/PSANN_WaveResNet_Context_Demo.ipynb`, `notebooks/PSANN_SineParam_Comparison.ipynb`, `notebooks/PSANN_Parity_and_Probes.ipynb`) with the new context builder + float32 guidance; parity Colab link now mirrors the updated tips.
  2. (done 2025-10-28) Add minmax-scaler warm-start regression plus early-stopping GPU coverage to `tests/test_regressor_basic.py` / `tests/test_training_loop.py`; see new tests `test_minmax_scaler_warm_start_tracks_global_range` and `test_training_loop_early_stopping_runs_on_cuda`.
  3. (done 2025-10-28) Audit `docs/lsm_robustness_todo.md` and prune/refresh items now that extras pipeline is retired; extras backlog condensed and active tasks captured under "Active Focus".
  4. (done 2025-10-29) Create a unified HISSO/perf logging script that records key metrics and checkpoints so GPU runs can execute remotely and results imported back here (spec drafted in `docs/HISSO_logging_spec.md`).
  5. (done 2025-10-29) Design a pluggable convolutional front-end for `PSANNRegressor`/residual variants so higher-dimensional inputs can be handled without introducing parallel `Conv*Regressor` classes; expose a `with_conv_stem` helper and document migration guidance.
  6. (done 2025-10-29) Profile dataloader shuffle vs. stateful constraints and capture guidance in docs once mixed-precision coverage is staged; README/TECHNICAL_DETAILS document the policy, and 	ests/test_dataloader_shuffle.py locks the behaviour.
  7. (done 2025-11-01) Colab HISSO logging runs captured for dense and WaveResNet configs; artifacts synced to `runs/hisso/dense/dense_cuda_colab_gpu_20251101_180009/` and `runs/hisso/wave_resnet/wave_resnet_cuda_colab_gpu_20251101_180016/`. Dense throughput 203 eps/s (2.68 s wall, train/val/test 0.245/0.304/0.231, reward_mean -0.111); WaveResNet throughput 161 eps/s (3.34 s wall, train/val/test 1.435/1.402/1.569, reward_mean -0.182, turnover 2.65). Metrics and memory notes now live in `docs/PSANN_Results_Compendium.md`, the README GPU status bullet, and the notebook CUDA metrics cell; keep the CUDA regression suite (`tests/test_hisso_primary.py`) queued for the dedicated runpod slot.

**CPU Prep Before GPU Run**
- Draft the notebook and Colab pointer copy for the logging CLI now, leaving TODO markers where GPU-derived metrics will be inserted after the remote sweep.
- Queue runpod datasets, keep scaler warm-start fixtures handy, and rerun the CPU smoke baselines (`runs/hisso/dense_smoke_cpu_dev`, `runs/hisso/wave_resnet_cpu_smoke`) whenever cleanup touches data loading so the GPU session starts from a stable state.

**Final GPU Sweep (run last)**
- (done 2025-11-02, Runpod L4) HISSO GPU validation and CUDA smoke coverage executed:
  - `pytest -m "not slow"` â†’ 129 passed (18 deselected), 1 warning; `pytest` â†’ 147 passed, 1 warning.
  - `tests/test_hisso_primary.py` â†’ 14 passed; `tests/test_hisso_smoke.py tests/test_hisso_logging_cli.py` â†’ 5 passed.
  - `tests/test_training_loop.py::test_training_loop_early_stopping_runs_on_cuda` â†’ 1 passed.
  - `tests/test_wave_resnet.py tests/test_wave_resnet_regressor.py` â†’ 16 passed; `tests/test_conv_nets.py tests/test_conv_stem_helper.py` â†’ 18 passed.
- (done 2025-11-02, Runpod L4) Execute the HISSO/perf logging CLI to produce metrics and checkpoints. WaveResNet run: `runs/hisso/wave_resnet_cuda_runpod_20251102_153117/` (throughput ~107.3 eps/s; best_epoch=17; train/val/test 0.621/0.755/0.670; reward_mean -0.114; turnover 2.69; AMP float16).
- (done 2025-11-02) Docs refreshed (`README.md`, `docs/PSANN_Results_Compendium.md`, `notebooks/PSANN_WaveResNet_Context_Demo.ipynb`) with CUDA metrics and pointers.
- Historical snapshot (2025-10-27): 16/158 bullets complete (~10%) with focus on exports, alias docs, and initial estimator hygiene-kept here for traceability.
- Reminder: terminate any command that hangs longer than 10 minutes; keep changes surgical and test-backed.

**Personal note**
Nicholas, excited to collaborate. This codebase reflects a lot of careful thinking; I'll keep changes surgical, fast, and test-backed. If you want me to start by eliminating the sklearn duplication and wiring `set_params` normalization, I can jump on that next.

